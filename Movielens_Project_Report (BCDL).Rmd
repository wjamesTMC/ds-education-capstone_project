---
title: "Movielens Project (B. James / BCDL)"
author: "Bill James / jamesbcdl@gmail.com"
date: "April 14, 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Executive Summary (Introduction and Overview)**

This document describes the training of a machine learning algorithm on a subset of the MovieLens dataset so that it will accurately predict moving ratings on a second subset (the test set). The goal of the analysis is to establish an algorithm with a residual means squared error (RMSE) OF 0.87750 or lower.

The approach used in this analysis was to:
* Download the 10M version of the MovieLens dataset (movies, ratings, tags)
* Combine the ratings and movies sets into a single dataset for analysis
* Split out a training subset (9,000,055 ratings) and a test subset (999,999 ratings)
* Successively improve an algorithm to produce an RMSE below 0.87750 on the training subset
* Verify that this algorithm produces similar results on the test dataset

In training the algorithm, the following steps were taken:
* Establish a baseline - the simple average rating for all movies
* Introduce the beta b_i, to account for general bias in ratings
* Introduce the beta b_u, to account for user-specific effects
* Test to see if regularization would improve the model results

The process above did produce a final RMSE of xxx for the training set and xxx for the test set. Eliminating user-specific effects seemed to have the most impact on improving the RMSE. Regularization did not have any effect on the results, due, it is assumed, to the fact that no movie had fewer than 20 users rating it, thereby mitigating the effect of very few users skewing the ratings with very high or very low ratings.

**The Dataset**

The source dataset contained 10,000,054 user ratings applied to 10,681 movies by 10,677 users. Users were selected at random for inclusion. All users selected had rated at least 20 movies. Each movie and user is represented by a unique Id.

The source data were contained in three files, movies.dat, ratings.dat and tags.dat. For this analysis, the userId, movieId, rating, and timestamp fields were selected from the ratings data, and the movieId, title, and genres fields from the movies data. These were then joined on movieId to create the dataset for the analysis.

Note that genres were of various types - single types and combinations - for example:

```{r, echo=FALSE, warning=FALSE}
# Bring in the necessary libraries
library(tidyverse)
library(tidyr)
library(caret)
library(dplyr)
library(data.table)
library(splitstackshape)
library(reshape2)

# Download the MovieLens data 
dl <- tempfile()
download.file("http://files.grouplens.org/datasets/movielens/ml-10m.zip", dl)

# Create the datasets
ratings <- fread(text = gsub("::", "\t", readLines(unzip(dl, "ml-10M100K/ratings.dat"))), col.names = c("userId", "movieId", "rating", "timestamp"))

movies <- str_split_fixed(readLines(unzip(dl, "ml-10M100K/movies.dat")), "\\::", 3)
colnames(movies) <- c("movieId", "title", "genres")

movies <- as.data.frame(movies) %>% 
         mutate(movieId = as.numeric(levels(movieId))[movieId],
         title = as.character(title),
         genres = as.character(genres))

movielens <- left_join(ratings, movies, by = "movieId")

# Create the validation set (10% of MovieLens data)
set.seed(1)
test_index <- createDataPartition(y = movielens$rating, times = 1, p = 0.1, list = FALSE)
edx <- movielens[-test_index,]
temp <- movielens[test_index,]

# Make sure userId and movieId in validation set are also in edx set
validation <- temp %>% 
  semi_join(edx, by = "movieId") %>%
  semi_join(edx, by = "userId")

# Add rows removed from validation set back into edx set
removed <- anti_join(temp, validation)
edx <- rbind(edx, removed)

rm(dl, ratings, movies, test_index, temp, movielens, removed)
```
```{r}
head(edx$genres,10)
```

**Establishing the RMSE and the Baseline**

The residual means squared error is the  error made when predicting a movie rating. The RMSE function computes the residual means squared error for a vector of ratings and their corresponding predictors.

```{r}
RMSE <- function(true_ratings, predicted_ratings){
  sqrt(mean((true_ratings - predicted_ratings)^2))
}
```

The simple mean of the training set movie ratings was used as a baseline and stored in a dataframe for comparison with further RMSEs.

```{r, echo=FALSE}
mu <- mean(edx$rating)
avg_rmse <- RMSE(edx$rating, mu)
rmse_results <- data_frame(method = "Just the average", RMSE = avg_rmse)
rmse_results
```
# Methods and analysis
#    Data clearning
#    data exploration and visualization
#    Insights and modeling approach



```{r, echo=FALSE, warning=FALSE}

```



```{r, echo=FALSE, warning=FALSE}

```



```{r, echo=FALSE, warning=FALSE}

```



```{r, echo=FALSE, warning=FALSE}

```



```{r, echo=FALSE, warning=FALSE}

```



```{r, echo=FALSE, warning=FALSE}

```



```{r, echo=FALSE, warning=FALSE}

```



```{r, echo=FALSE, warning=FALSE}

```



```{r, echo=FALSE, warning=FALSE}

```

# Results



```{r, echo=FALSE, warning=FALSE}

```

# Conclusions